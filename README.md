# C4PS - Captioning, Enhancement, and Multilingual Processing for Socials

[![Python](https://img.shields.io/badge/Python-3.12%2B-blue.svg)](https://www.python.org/)
[![PyTorch](https://img.shields.io/badge/PyTorch-Latest-red.svg)](https://pytorch.org/)
[![Transformers](https://img.shields.io/badge/Transformers-HuggingFace-ff69b4.svg)](https://huggingface.co/docs/transformers/index)
[![Real-ESRGAN](https://img.shields.io/badge/RealESRGAN-Image%20Enhancement-4b8bbe.svg)](https://github.com/xinntao/Real-ESRGAN)
[![Argos Translate](https://img.shields.io/badge/Argos%20Translate-Offline%20Translation-008080.svg)](https://github.com/argosopentech/argos-translate)
[![Discord](https://img.shields.io/badge/Discord-Webhooks-5865F2.svg)](https://discord.com/)
[![NumPy](https://img.shields.io/badge/NumPy-Scientific-013243.svg)](https://numpy.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](./LICENSE)


> A modular pipeline for image enhancement, caption generation, and offline multilingual translation. Designed to be used locally (no training required) with optional Discord reporting.

## Table of contents

- Overview
- Key features
- Tech stack
- Project layout
- Available scripts and utilities
- Assets & weights
- Setup & installation
- How to run (examples)
- Configuration
- Roadmap
- Contributing
- License

## Overview
C4PS is a local pipeline that performs image enhancement (Real-ESRGAN), caption generation (transformer-based model), and offline translation (Argos Translate). It also includes small utilities and scripts for comparisons, weight conversion, and sweep/benchmarking.

## Key features

- Image enhancement using Real-ESRGAN models
- Caption generation via a pre-trained transformer model (cached locally)
- Offline multilingual translation with Argos Translate
- Optional Discord webhook reporting
- Terminal UI for interactive runs
- Utilities for model weight handling and comparisons

## Tech stack

- Python 3.12+
- PyTorch
- Hugging Face Transformers (captioning)
- Real-ESRGAN (image upscaling)
- Argos Translate (offline translation)
- NumPy, Pillow

## Project layout
Top-level snapshot:

```text
C4PS/
    ├── main.py                      # Main pipeline entrypoint
    ├── choose_and_run.py            # Interactive chooser to run subsets of the pipeline
    ├── compare_x4_x4plus.py         # Script to compare x4 vs x4plus ESRGAN outputs
    ├── convert_weights.py           # Helper to convert or preprocess model weights
    ├── sweep_enhancement.py         # Script to run enhancement sweeps/benchmarks
    ├── sweep_results.csv            # Results produced by sweeps
    ├── dummy.pth                    # Example / placeholder weight file (kept in repo)
    ├── requirements.txt             # Python dependencies
    ├── README.md                    # This file (updated)
    ├── LICENSE
    ├── assets/                      # Downloaded or example images
    ├── outputs/                     # Pipeline outputs (images, captions, etc.)
    ├── compare_outputs/             # Output comparisons generated by scripts
    ├── captioning/                  # Captioning model loader and generator
    │   ├── generator.py
    │   └── model.py
    ├── enhancement/                 # Real-ESRGAN wrapper and model loader
    │   ├── enhancer.py
    │   └── model.py
    ├── translation/                 # Offline translation logic
    │   └── translator.py
    ├── utils/                       # Helpers and configuration
    │   ├── config.py
    │   ├── downloader.py
    │   ├── output_handler.py
    │   └── terminal_ui.py
    ├── gfpgan/                      # GFPGAN-related files (detection/parsing weights)
    │   └── weights/
    │       ├── detection_Resnet50_Final.pth
    │       └── parsing_parsenet.pth
    └── weights/                      # ESRGAN + captioning caches
        ├── GFPGANv1.4.pth
        ├── RealESRGAN_x2.pth
        ├── RealESRGAN_x2_chk.pth
        ├── RealESRGAN_x4.pth
        ├── RealESRGAN_x4_chk.pth
        ├── RealESRGAN_x4plus.pth
        └── transformer_model_cache/  # HuggingFace model cache (microsoft/git-base-coco)
```

Notes:

- `dummy.pth` is a placeholder weight file included in the repository.
- The `weights/transformer_model_cache` folder contains downloaded model files for the captioning transformer and may be large.

## Available scripts and what they do

- `main.py` — Main pipeline. Runs enhancement, captioning, translation, and outputs results.
- `choose_and_run.py` — Interactive helper that lets you run parts of the pipeline (useful for testing or partial runs).
- `compare_x4_x4plus.py` — Compare outputs produced by x4 and x4plus Real-ESRGAN weights.
- `convert_weights.py` — Utility to convert or reformat weights for certain models (read source for supported conversions).
- `sweep_enhancement.py` — Run enhancement parameter sweeps and produce `sweep_results.csv`.
- `compare_outputs/` — Folder where comparison artifacts are saved when running comparison scripts.

If you'd like a quick description of any script's CLI usage, open the top of the script (they usually include an argument parser or a short help message).

## Assets & weights (what's in the repo)


- weights/
  - GFPGANv1.4.pth
  - RealESRGAN_x2.pth, RealESRGAN_x2_chk.pth
  - RealESRGAN_x4.pth, RealESRGAN_x4_chk.pth
  - RealESRGAN_x4plus.pth
  - transformer_model_cache/ (captioning model files cached under weights)

- gfpgan/weights/
  - detection_Resnet50_Final.pth
  - parsing_parsenet.pth

If you plan to re-download or update weights, check `utils/downloader.py` and `utils/config.py` for the default URLs and locations.

## Setup and installation

Follow the standard steps. Example on Windows PowerShell:

```powershell
git clone https://github.com/TheRevanite/C4PS.git
cd C4PS
# optional virtual env
python -m venv venv; .\venv\Scripts\Activate
pip install -r requirements.txt
```

Note: the captioning model cache can be large. Make sure you have enough disk space before running the pipeline the first time.

## How to run (examples)

- Full pipeline (default behavior):

```powershell
python main.py
```

- Use the interactive helper to choose parts of the pipeline:

```powershell
python choose_and_run.py
```

- Run a sweep/benchmark for enhancement:

```powershell
python sweep_enhancement.py
```

- Compare ESRGAN variants:

```powershell
python compare_x4_x4plus.py
```

The scripts usually accept additional CLI options; inspect the top of each script or run them with `-h` / `--help`.

## Configuration

Central configuration lives in `utils/config.py`. Typical items to set or override:

- `IMAGE_URL` — sample image URL used by downloader (or set via `.env`)
- `ENHANCER_WEIGHTS_URL` — default download URL(s) for Real-ESRGAN
- `TARGET_LANGUAGES` — list of languages for translation
- `CAPTIONING_MODEL_PATH` — local path to captioning model cache
- `DISCORD_WEBHOOK_URL` — if set, the pipeline can post results to Discord

Environment variables and secrets (optional) can be placed in a `.env` file at project root. Example keys used by the repo:

```env
DISCORD_WEBHOOK_URL="your_discord_webhook_url_here"
DISCORD_SERVER_INVITE="your_discord_server_invite_here"
IMAGE_URL="your_image_link_here"
```

## Roadmap

- [x] Image enhancement with Real-ESRGAN
- [x] Transformer-based captioning
- [x] Offline multilingual translation
- [x] Discord webhook integration
- [x] Interactive terminal UI
- [ ] Add more language support
- [ ] REST API for external integration
- [ ] Edge device optimization

## Contributing

Please open an issue or submit a PR. Typical workflow:

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/name`)
3. Implement changes and add tests where possible
4. Run the pipeline locally to verify behavior
5. Push and open a PR

## License

This project is licensed under the MIT License - see the [LICENSE](./LICENSE) file for details.
